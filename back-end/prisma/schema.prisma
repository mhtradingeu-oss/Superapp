generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  passwordHash String
  name         String?
  role         String    @default("USER")
  status       String    @default("ACTIVE")
  lastLoginAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  auditLogs    AuditLog[]
}

model Role {
  id          String           @id @default(cuid())
  name        String           @unique
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  permissions RolePermission[]
}

model Permission {
  id          String           @id @default(cuid())
  code        String           @unique
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  roles       RolePermission[]
}

model RolePermission {
  id           String      @id @default(cuid())
  roleId       String
  permissionId String
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  role         Role        @relation(fields: [roleId], references: [id])
  permission   Permission  @relation(fields: [permissionId], references: [id])
}

model Policy {
  id        String   @id @default(cuid())
  name      String
  rulesJson String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AIRestrictionPolicy {
  id        String   @id @default(cuid())
  name      String
  rulesJson String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  action     String
  entityType String?
  entityId   String?
  metadataJson String?
  createdAt  DateTime @default(now())

  user       User?    @relation(fields: [userId], references: [id])
}

model Brand {
  id               String           @id @default(cuid())
  name             String
  slug             String           @unique
  description      String?
  countryOfOrigin  String?
  defaultCurrency  String?
  settingsJson     String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  identity         BrandIdentity?
  rules            BrandRules?
  aiConfig         BrandAIConfig?
  categories       BrandCategory[]
  products         BrandProduct[]
  contentPlans     ContentPlan[]
  campaigns        Campaign[]
  loyaltyPrograms  LoyaltyProgram[]
  partners         Partner[]
  whiteLabelBrands WhiteLabelBrand[]
}

model BrandIdentity {
  id               String   @id @default(cuid())
  brandId          String   @unique
  vision           String?
  mission          String?
  values           String?
  toneOfVoice      String?
  persona          String?
  brandStory       String?
  keywords         String?
  colorPalette     String?
  packagingStyle   String?
  socialProfilesJson String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  brand            Brand    @relation(fields: [brandId], references: [id])
}

model BrandRules {
  id                String   @id @default(cuid())
  brandId           String   @unique
  namingRules       String?
  descriptionRules  String?
  marketingRules    String?
  discountRules     String?
  pricingConstraints String?
  restrictedWords   String?
  allowedWords      String?
  aiRestrictions    String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  brand             Brand    @relation(fields: [brandId], references: [id])
}

model BrandAIConfig {
  id                 String   @id @default(cuid())
  brandId            String   @unique
  aiPersonality      String?
  aiTone             String?
  aiContentStyle     String?
  aiPricingStyle     String?
  aiEnabledActionsJson String?
  aiBlockedTopicsJson String?
  aiModelVersion     String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  brand              Brand    @relation(fields: [brandId], references: [id])
}

model BrandCategory {
  id          String   @id @default(cuid())
  brandId     String
  name        String
  slug        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  brand       Brand    @relation(fields: [brandId], references: [id])
  products    BrandProduct[]
}

model BrandProduct {
  id             String            @id @default(cuid())
  brandId        String
  categoryId     String?
  name           String
  slug           String            @unique
  description    String?
  sku            String?           @unique
  upc            String?
  line           String?
  status         String            @default("ACTIVE")
  weightGrams    Int?
  netContentMl   Int?
  unitsPerCarton Int?
  imageUrl       String?
  qrUrl          String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt

  brand          Brand             @relation(fields: [brandId], references: [id])
  category       BrandCategory?    @relation(fields: [categoryId], references: [id])
  pricing        ProductPricing?
  competitorPrices CompetitorPrice[]
  priceDrafts    ProductPriceDraft[]
  aiPricingHistory AIPricingHistory[]
  aiLearningJournal AILearningJournal[]
  dealProducts   DealProduct[]
  partnerPrices  PartnerPricing[]
  partnerOrderItems PartnerOrderItem[]
  standInventories StandInventory[]
  standOrderItems StandOrderItem[]
  affiliatePerformances AffiliatePerformance[]
  inventoryItems InventoryItem[]
  inventoryTransactions InventoryTransaction[]
  purchaseOrderItems PurchaseOrderItem[]
  shipmentItems  ShipmentItem[]
  invoiceItems   InvoiceItem[]
  whiteLabelProducts WhiteLabelProduct[]
  salesOrderItems SalesOrderItem[]
}

model ProductPricing {
  id                     String   @id @default(cuid())
  productId              String   @unique
  factoryPriceUnit       Decimal?
  totalFactoryPriceCarton Decimal?
  eprLucidPerUnit        Decimal?
  shippingInboundPerUnit Decimal?
  gs1PerUnit             Decimal?
  retailPackagingPerUnit Decimal?
  qcPifPerUnit           Decimal?
  operationsPerUnit      Decimal?
  marketingPerUnit       Decimal?
  cogsEur                Decimal?
  fullCostEur            Decimal?
  b2cStoreNet            Decimal?
  b2cStoreInc            Decimal?
  b2cMarginPct           Decimal?
  amazonNet              Decimal?
  amazonInc              Decimal?
  amazonMarginPct        Decimal?
  dealerBasicNet         Decimal?
  dealerPlusNet          Decimal?
  standPartnerNet        Decimal?
  distributorNet         Decimal?
  map                    Decimal?
  uvpNet                 Decimal?
  uvpInc                 Decimal?
  vatPct                 Decimal?
  grundpreis             String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  product                BrandProduct @relation(fields: [productId], references: [id])
}

model CompetitorPrice {
  id             String   @id @default(cuid())
  productId      String
  competitorName String
  marketplace    String?
  country        String?
  url            String?
  priceNet       Decimal?
  priceGross     Decimal?
  currency       String?
  collectedAt    DateTime?
  sourceType     String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  product        BrandProduct @relation(fields: [productId], references: [id])
}

model ProductPriceDraft {
  id              String   @id @default(cuid())
  productId       String
  channel         String
  oldNet          Decimal?
  oldGross        Decimal?
  oldMargin       Decimal?
  newNet          Decimal?
  newGross        Decimal?
  newMargin       Decimal?
  changePct       Decimal?
  status          String   @default("DRAFT")
  createdByUserId String?
  approvedByUserId String?
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  product         BrandProduct @relation(fields: [productId], references: [id])
}

model AIPricingHistory {
  id                String   @id @default(cuid())
  productId         String
  channel           String
  oldNet            Decimal?
  newNet            Decimal?
  aiAgentName       String?
  confidenceScore   Decimal?
  reasonSummary     String?
  impactEstimateJson String?
  resultSummaryJson String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  product           BrandProduct @relation(fields: [productId], references: [id])
}

model AILearningJournal {
  id                String   @id @default(cuid())
  productId         String?
  source            String?
  eventType         String?
  inputSnapshotJson String?
  outputSnapshotJson String?
  actualResultJson  String?
  aiAdjustmentJson  String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  product           BrandProduct? @relation(fields: [productId], references: [id])
}

model Person {
  id        String   @id @default(cuid())
  firstName String?
  lastName  String?
  email     String?  @unique
  phone     String?
  country   String?
  city      String?
  tags      String?
  source    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  leads     Lead[]
  companies Company[]
}

model Company {
  id        String   @id @default(cuid())
  name      String
  type      String?
  vatNumber String?
  country   String?
  city      String?
  website   String?
  tags      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  leads     Lead[]
  deals     Deal[]
}

model Lead {
  id               String   @id @default(cuid())
  personId         String?
  companyId        String?
  source           String?
  status           String?
  score            Int?
  pipelineId       String?
  stageId          String?
  assignedToUserId String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  person           Person?  @relation(fields: [personId], references: [id])
  company          Company? @relation(fields: [companyId], references: [id])
  pipeline         Pipeline? @relation(fields: [pipelineId], references: [id])
  stage            PipelineStage? @relation(fields: [stageId], references: [id])
  deals            Deal[]
}

model Pipeline {
  id        String          @id @default(cuid())
  name      String
  type      String?
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  stages    PipelineStage[]
  leads     Lead[]
}

model PipelineStage {
  id         String    @id @default(cuid())
  pipelineId String
  name       String
  order      Int?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  pipeline   Pipeline  @relation(fields: [pipelineId], references: [id])
  leads      Lead[]
}

model Deal {
  id                String    @id @default(cuid())
  leadId            String?
  companyId         String?
  title             String
  value             Decimal?
  currency          String?
  status            String?
  expectedCloseDate DateTime?
  ownerId           String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  lead              Lead?     @relation(fields: [leadId], references: [id])
  company           Company?  @relation(fields: [companyId], references: [id])
  products          DealProduct[]
}

model DealProduct {
  id        String       @id @default(cuid())
  dealId    String
  productId String
  quantity  Int
  price     Decimal
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  deal      Deal         @relation(fields: [dealId], references: [id])
  product   BrandProduct @relation(fields: [productId], references: [id])
}

model CRMSegment {
  id             String   @id @default(cuid())
  name           String
  filtersJson    String?
  createdByUserId String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model CRMTask {
  id             String   @id @default(cuid())
  title          String
  dueDate        DateTime?
  status         String?
  assignedToUserId String?
  leadId         String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model CRMNote {
  id         String   @id @default(cuid())
  entityType String
  entityId   String
  content    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model InteractionLog {
  id        String   @id @default(cuid())
  channel   String
  direction String?
  summary   String?
  metaJson  String?
  createdAt DateTime @default(now())
}

model MarketingChannel {
  id        String   @id @default(cuid())
  name      String
  type      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  contentPlanItems ContentPlanItem[]
  campaigns Campaign[]
}

model ContentPlan {
  id          String   @id @default(cuid())
  brandId     String
  name        String
  periodStart DateTime?
  periodEnd   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  brand       Brand    @relation(fields: [brandId], references: [id])
  items       ContentPlanItem[]
}

model ContentPlanItem {
  id            String           @id @default(cuid())
  contentPlanId String
  channelId     String?
  topic         String?
  format        String?
  status        String?
  scheduledAt   DateTime?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  contentPlan   ContentPlan      @relation(fields: [contentPlanId], references: [id])
  channel       MarketingChannel? @relation(fields: [channelId], references: [id])
}

model Campaign {
  id         String             @id @default(cuid())
  brandId    String
  channelId  String?
  name       String
  objective  String?
  budget     Decimal?
  status     String?
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt

  brand      Brand              @relation(fields: [brandId], references: [id])
  channel    MarketingChannel?  @relation(fields: [channelId], references: [id])
  adSets     CampaignAdSet[]
  performanceLogs MarketingPerformanceLog[]
}

model CampaignAdSet {
  id          String    @id @default(cuid())
  campaignId  String
  audienceJson String?
  placementJson String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  campaign    Campaign  @relation(fields: [campaignId], references: [id])
  ads         CampaignAd[]
}

model CampaignAd {
  id        String        @id @default(cuid())
  adSetId   String
  creativeId String?
  status    String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  adSet     CampaignAdSet @relation(fields: [adSetId], references: [id])
}

model MarketingPerformanceLog {
  id          String    @id @default(cuid())
  campaignId  String
  date        DateTime
  impressions Int?
  clicks      Int?
  spend       Decimal?
  conversions Int?
  revenue     Decimal?
  kpiJson     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  campaign    Campaign  @relation(fields: [campaignId], references: [id])
}

model SalesRep {
  id          String    @id @default(cuid())
  userId      String?
  code        String?
  region      String?
  status      String?   @default("ACTIVE")
  kpiTargetMonthlyJson String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  territories SalesRepTerritoryAssignment[]
  routes      SalesRoutePlan[]
  visits      SalesVisit[]
  quotes      SalesQuote[]
  orders      SalesOrder[]
}

model SalesTerritory {
  id        String    @id @default(cuid())
  name      String
  country   String?
  city      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  assignments SalesRepTerritoryAssignment[]
}

model SalesRepTerritoryAssignment {
  id          String         @id @default(cuid())
  repId       String
  territoryId String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  rep         SalesRep       @relation(fields: [repId], references: [id])
  territory   SalesTerritory @relation(fields: [territoryId], references: [id])
}

model SalesRoutePlan {
  id        String          @id @default(cuid())
  repId     String
  date      DateTime?
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  rep       SalesRep        @relation(fields: [repId], references: [id])
  stops     SalesRouteStop[]
}

model SalesRouteStop {
  id          String        @id @default(cuid())
  routePlanId String
  partnerId   String?
  dealerId    String?
  orderIndex  Int?
  status      String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  routePlan   SalesRoutePlan @relation(fields: [routePlanId], references: [id])
}

model SalesVisit {
  id          String    @id @default(cuid())
  repId       String
  partnerId   String?
  date        DateTime?
  purpose     String?
  result      String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  rep         SalesRep  @relation(fields: [repId], references: [id])
  notes       SalesVisitNote[]
}

model SalesVisitNote {
  id        String    @id @default(cuid())
  visitId   String
  content   String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  visit     SalesVisit @relation(fields: [visitId], references: [id])
}

model SalesQuote {
  id        String           @id @default(cuid())
  repId     String?
  partnerId String?
  status    String?
  validUntil DateTime?
  total     Decimal?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  rep       SalesRep?        @relation(fields: [repId], references: [id])
  items     SalesQuoteItem[]
}

model SalesQuoteItem {
  id        String       @id @default(cuid())
  quoteId   String
  productId String
  quantity  Int
  price     Decimal
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  quote     SalesQuote   @relation(fields: [quoteId], references: [id])
  product   BrandProduct @relation(fields: [productId], references: [id])
}

model SalesOrder {
  id             String            @id @default(cuid())
  repId          String?
  dealerId       String?
  standPartnerId String?
  status         String?
  total          Decimal?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt

  rep            SalesRep?         @relation(fields: [repId], references: [id])
  items          SalesOrderItem[]
}

model SalesOrderItem {
  id        String       @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Decimal
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  order     SalesOrder   @relation(fields: [orderId], references: [id])
  product   BrandProduct @relation(fields: [productId], references: [id])
}

model Partner {
  id            String            @id @default(cuid())
  brandId       String?
  type          String
  name          String
  country       String?
  city          String?
  vatNumber     String?
  contactPersonId String?
  status        String?           @default("ACTIVE")
  tier          String?
  settingsJson  String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  brand         Brand?            @relation(fields: [brandId], references: [id])
  contracts     PartnerContract[]
  pricing       PartnerPricing[]
  orders        PartnerOrder[]
  standPartners StandPartner[]
  whiteLabelBrands WhiteLabelBrand[]
}

model PartnerContract {
  id        String   @id @default(cuid())
  partnerId String
  startDate DateTime?
  endDate   DateTime?
  termsJson String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  partner   Partner  @relation(fields: [partnerId], references: [id])
}

model PartnerPricing {
  id        String       @id @default(cuid())
  partnerId String
  productId String
  netPrice  Decimal?
  currency  String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  partner   Partner      @relation(fields: [partnerId], references: [id])
  product   BrandProduct @relation(fields: [productId], references: [id])
}

model PartnerOrder {
  id        String           @id @default(cuid())
  partnerId String
  status    String?
  total     Decimal?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  partner   Partner          @relation(fields: [partnerId], references: [id])
  items     PartnerOrderItem[]
}

model PartnerOrderItem {
  id        String       @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Decimal
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  order     PartnerOrder @relation(fields: [orderId], references: [id])
  product   BrandProduct @relation(fields: [productId], references: [id])
}

model StandPartner {
  id               String        @id @default(cuid())
  partnerId        String
  standType        String?
  locationAddress  String?
  city             String?
  country          String?
  status           String?       @default("ACTIVE")
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  partner          Partner       @relation(fields: [partnerId], references: [id])
  standUnits       StandUnit[]
  orders           StandOrder[]
}

model StandUnit {
  id                 String    @id @default(cuid())
  standPartnerId     String
  code               String?
  locationDescription String?
  status             String?   @default("ACTIVE")
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  standPartner       StandPartner @relation(fields: [standPartnerId], references: [id])
  inventories        StandInventory[]
  snapshots          StandInventorySnapshot[]
}

model StandInventory {
  id         String       @id @default(cuid())
  standUnitId String
  productId  String
  quantity   Int          @default(0)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  standUnit  StandUnit    @relation(fields: [standUnitId], references: [id])
  product    BrandProduct @relation(fields: [productId], references: [id])
}

model StandInventorySnapshot {
  id          String   @id @default(cuid())
  standUnitId String
  snapshotAt  DateTime
  dataJson    String?
  createdAt   DateTime @default(now())

  standUnit   StandUnit @relation(fields: [standUnitId], references: [id])
}

model StandOrder {
  id             String         @id @default(cuid())
  standPartnerId String
  status         String?
  total          Decimal?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  standPartner   StandPartner   @relation(fields: [standPartnerId], references: [id])
  items          StandOrderItem[]
}

model StandOrderItem {
  id        String       @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Decimal
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  order     StandOrder   @relation(fields: [orderId], references: [id])
  product   BrandProduct @relation(fields: [productId], references: [id])
}

model Affiliate {
  id         String    @id @default(cuid())
  userId     String?
  personId   String?
  code       String?   @unique
  type       String?
  channel    String?
  profileUrl String?
  status     String?   @default("ACTIVE")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  user       User?     @relation(fields: [userId], references: [id])
  performance AffiliatePerformance[]
  payouts    AffiliatePayout[]
  links      AffiliateLink[]
}

model AffiliateLink {
  id          String     @id @default(cuid())
  affiliateId String
  linkCode    String     @unique
  targetUrl   String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  affiliate   Affiliate  @relation(fields: [affiliateId], references: [id])
}

model AffiliatePerformance {
  id           String       @id @default(cuid())
  affiliateId  String
  productId    String?
  periodStart  DateTime?
  periodEnd    DateTime?
  clicks       Int          @default(0)
  orders       Int          @default(0)
  revenue      Decimal?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  affiliate    Affiliate    @relation(fields: [affiliateId], references: [id])
  product      BrandProduct? @relation(fields: [productId], references: [id])
}

model AffiliatePayout {
  id           String    @id @default(cuid())
  affiliateId  String
  amount       Decimal?
  currency     String?
  status       String?
  paidAt       DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  affiliate    Affiliate @relation(fields: [affiliateId], references: [id])
}

model LoyaltyProgram {
  id         String    @id @default(cuid())
  brandId    String
  name       String
  type       String?
  rulesJson  String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  brand      Brand     @relation(fields: [brandId], references: [id])
  customers  LoyaltyCustomer[]
}

model LoyaltyCustomer {
  id         String    @id @default(cuid())
  userId     String?
  personId   String?
  programId  String
  pointsBalance Int    @default(0)
  tierId     String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  program    LoyaltyProgram @relation(fields: [programId], references: [id])
  transactions LoyaltyTransaction[]
  redemptions RewardRedemption[]
}

model LoyaltyTransaction {
  id              String    @id @default(cuid())
  customerId      String
  programId       String
  pointsChange    Int
  reason          String?
  sourceEntityType String?
  sourceEntityId  String?
  createdAt       DateTime  @default(now())

  customer        LoyaltyCustomer @relation(fields: [customerId], references: [id])
  program         LoyaltyProgram  @relation(fields: [programId], references: [id])
}

model RewardRedemption {
  id          String          @id @default(cuid())
  customerId  String
  rewardId    String?
  programId   String?
  pointsSpent Int
  status      String?
  createdAt   DateTime        @default(now())

  customer    LoyaltyCustomer @relation(fields: [customerId], references: [id])
}

model Warehouse {
  id        String            @id @default(cuid())
  name      String
  location  String?
  type      String?
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  items     InventoryItem[]
  transactions InventoryTransaction[]
  outgoingShipments Shipment[] @relation("Shipment_fromWarehouse")
  incomingShipments Shipment[] @relation("Shipment_toWarehouse")
}

model InventoryItem {
  id          String      @id @default(cuid())
  warehouseId String
  productId   String
  quantity    Int         @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  warehouse   Warehouse   @relation(fields: [warehouseId], references: [id])
  product     BrandProduct @relation(fields: [productId], references: [id])
}

model InventoryTransaction {
  id          String      @id @default(cuid())
  warehouseId String
  productId   String
  type        String
  quantity    Int
  reason      String?
  createdAt   DateTime    @default(now())

  warehouse   Warehouse   @relation(fields: [warehouseId], references: [id])
  product     BrandProduct @relation(fields: [productId], references: [id])
}

model PurchaseOrder {
  id          String            @id @default(cuid())
  supplierId  String?
  status      String?
  total       Decimal?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  items       PurchaseOrderItem[]
}

model PurchaseOrderItem {
  id             String       @id @default(cuid())
  purchaseOrderId String
  productId      String
  quantity       Int
  cost           Decimal
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  purchaseOrder  PurchaseOrder @relation(fields: [purchaseOrderId], references: [id])
  product        BrandProduct  @relation(fields: [productId], references: [id])
}

model Shipment {
  id              String       @id @default(cuid())
  fromWarehouseId String?
  toWarehouseId   String?
  status          String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  fromWarehouse   Warehouse?   @relation("Shipment_fromWarehouse", fields: [fromWarehouseId], references: [id])
  toWarehouse     Warehouse?   @relation("Shipment_toWarehouse", fields: [toWarehouseId], references: [id])
  items           ShipmentItem[]
}

model ShipmentItem {
  id         String     @id @default(cuid())
  shipmentId String
  productId  String
  quantity   Int
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  shipment   Shipment   @relation(fields: [shipmentId], references: [id])
  product    BrandProduct @relation(fields: [productId], references: [id])
}

model Invoice {
  id            String    @id @default(cuid())
  customerType  String
  customerId    String?
  status        String?
  totalNet      Decimal?
  totalGross    Decimal?
  currency      String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  items         InvoiceItem[]
  payments      Payment[]
}

model InvoiceItem {
  id          String       @id @default(cuid())
  invoiceId   String
  productId   String
  quantity    Int
  unitPriceNet Decimal
  vatPct      Decimal?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  invoice     Invoice      @relation(fields: [invoiceId], references: [id])
  product     BrandProduct @relation(fields: [productId], references: [id])
}

model Payment {
  id        String   @id @default(cuid())
  invoiceId String
  amount    Decimal?
  method    String?
  status    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  invoice   Invoice  @relation(fields: [invoiceId], references: [id])
}

model Expense {
  id        String   @id @default(cuid())
  category  String
  amount    Decimal?
  currency  String?
  note      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RevenueRecord {
  id          String    @id @default(cuid())
  productId   String?
  channel     String?
  amount      Decimal?
  currency    String?
  periodStart DateTime?
  periodEnd   DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  product     BrandProduct? @relation(fields: [productId], references: [id])
}

model WhiteLabelBrand {
  id             String           @id @default(cuid())
  ownerPartnerId String?
  ownerAffiliateId String?
  name           String
  slug           String           @unique
  status         String?
  settingsJson   String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  ownerPartner   Partner?         @relation(fields: [ownerPartnerId], references: [id])
  ownerAffiliate Affiliate?       @relation(fields: [ownerAffiliateId], references: [id])
  products       WhiteLabelProduct[]
  orders         WhiteLabelOrder[]
}

model WhiteLabelProduct {
  id            String       @id @default(cuid())
  wlBrandId     String
  baseProductId String?
  name          String
  sku           String?      @unique
  pricingJson   String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  wlBrand       WhiteLabelBrand @relation(fields: [wlBrandId], references: [id])
  baseProduct   BrandProduct?   @relation(fields: [baseProductId], references: [id])
}

model WhiteLabelOrder {
  id        String    @id @default(cuid())
  wlBrandId String
  status    String?
  total     Decimal?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  wlBrand   WhiteLabelBrand @relation(fields: [wlBrandId], references: [id])
}

model AutomationEvent {
  id               String   @id @default(cuid())
  name             String
  sourceOS         String?
  payloadSchemaJson String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model AutomationRule {
  id            String   @id @default(cuid())
  name          String
  triggerEvent  String?
  conditionsJson String?
  actionsJson   String?
  enabled       Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model AutomationWorkflow {
  id        String   @id @default(cuid())
  name      String
  stepsJson String?
  enabled   Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AutomationLog {
  id         String   @id @default(cuid())
  eventName  String?
  ruleId     String?
  workflowId String?
  result     String?
  detailsJson String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model ScheduledJob {
  id            String   @id @default(cuid())
  name          String
  cronExpression String
  lastRunAt     DateTime?
  nextRunAt     DateTime?
  status        String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Notification {
  id        String   @id @default(cuid())
  userId    String?
  channel   String
  title     String
  body      String
  status    String?
  metaJson  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User?    @relation(fields: [userId], references: [id])
}

model NotificationTemplate {
  id           String   @id @default(cuid())
  code         String   @unique
  channel      String
  subject      String?
  body         String?
  variablesJson String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model KnowledgeDocument {
  id          String   @id @default(cuid())
  title       String
  category    String?
  tags        String?
  sourceType  String?
  content     String?
  language    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AIAgentConfig {
  id        String   @id @default(cuid())
  name      String   @unique
  osScope   String?
  configJson String?
  enabled   Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AIInsight {
  id         String   @id @default(cuid())
  os         String?
  entityType String?
  entityId   String?
  summary    String?
  detailsJson String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model AIReport {
  id          String   @id @default(cuid())
  title       String
  scope       String?
  periodStart DateTime?
  periodEnd   DateTime?
  content     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SocialMention {
  id         String   @id @default(cuid())
  platform   String
  author     String?
  content    String?
  sentiment  String?
  url        String?
  occurredAt DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model SocialTrend {
  id            String   @id @default(cuid())
  topic         String
  platform      String?
  score         Float?
  trendDataJson String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model InfluencerProfile {
  id             String   @id @default(cuid())
  handle         String
  platform       String
  followers      Int?
  engagementRate Float?
  profileUrl     String?
  tags           String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Ticket {
  id              String   @id @default(cuid())
  createdByUserId String?
  contactId       String?
  assignedToUserId String?
  status          String?
  priority        String?
  category        String?
  description     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
